<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Analysis Dashboard</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#ffd900",
            "secondary": "#00BFFF",
            "accent": "#00BFFF",
            "background-light": "#1C1C1C",
            "background-dark": "#0A0A0A",
            "surface-dark": "#1C1C1C",
            "text-primary": "#FFFFFF",
            "text-secondary": "#E0E0E0",
            "border-color": "#ffd90040",
            "nav-bg": "#111111"
          },
          fontFamily: { "display": ["Space Grotesk", "sans-serif"] },
          borderRadius: { "DEFAULT": "12px" },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    .glowing-border { box-shadow: 0 0 2px 0px #ffd900, 0 0 4px 0px #ffd90033, 0 0 8px 0px #ffd90022; }
    body { min-height: 100dvh; }
  </style>
</head>

<body class="bg-background-dark font-display flex flex-col min-h-screen">

  <div class="flex flex-1 min-h-[calc(100vh-96px)]">

    <aside class="flex flex-col items-center gap-8 bg-nav-bg p-4 border-r border-white/10 min-h-full">
      <div class="text-primary flex items-center justify-center">
        <span class="material-symbols-outlined !text-4xl">api</span>
      </div>
      <nav class="flex flex-col items-center gap-6">
        <a class="nav-item text-white/60 hover:text-accent transition-colors" href="index.html">
          <span class="material-symbols-outlined !text-3xl">upload_file</span>
        </a>
        <a class="nav-item text-white/60 hover:text-accent transition-colors" href="summary.html">
          <span class="material-symbols-outlined !text-3xl">description</span>
        </a>
        <a class="nav-item text-white/60 hover:text-accent transition-colors" href="history.html">
          <span class="material-symbols-outlined !text-3xl">history</span>
        </a>
        <a class="nav-item text-accent relative transition-colors" href="analysis.html">
          <span class="material-symbols-outlined !text-3xl">analytics</span>
          <div class="absolute -left-6 top-1/2 -translate-y-1/2 h-5 w-1 bg-accent rounded-full shadow-glow-accent"></div>
        </a>
      </nav>
    </aside>

    <main class="flex-1 space-y-6 p-4 text-text-primary">
      
      <div class="grid grid-cols-2 gap-4">
        <div class="flex flex-col gap-1.5 rounded-xl border border-border-color bg-surface-dark p-4 glowing-border">
          <p class="text-sm text-text-secondary">Total Documents</p>
          <p id="total-docs" class="text-2xl font-bold text-primary">...</p>
        </div>
        <div class="flex flex-col gap-1.5 rounded-xl border border-border-color bg-surface-dark p-4 glowing-border">
          <p class="text-sm text-text-secondary">Active Categories</p>
          <p id="unique-cats" class="text-2xl font-bold text-primary">...</p>
        </div>
      </div>

      <div class="flex flex-col gap-4 rounded-xl border border-border-color bg-surface-dark p-4 glowing-border">
        <p class="text-base font-bold">Category Distribution</p>
        <p class="text-sm text-text-secondary">Frequency of document types</p>
        
        <div id="stats-grid" class="grid min-h-[160px] gap-x-4 gap-y-4 grid-cols-[auto_1fr] items-center py-2">
            <div class="col-span-2 flex items-center gap-2 text-white/50">
                <div class="w-4 h-4 border-2 border-accent border-t-transparent rounded-full animate-spin"></div>
                Loading statistics...
            </div>
        </div>
      </div>

    </main>
  </div>

  <script>
    async function loadAnalysis() {
        const totalDocsEl = document.getElementById("total-docs");
        const uniqueCatsEl = document.getElementById("unique-cats");
        const gridEl = document.getElementById("stats-grid");

        try {
            const response = await fetch("http://127.0.0.1:8000/analysis");
            if (!response.ok) throw new Error("Failed to load analysis");
            
            const data = await response.json();

            // 1. Update Top Stats
            totalDocsEl.textContent = data.total_documents;
            uniqueCatsEl.textContent = data.unique_categories;

            // 2. Generate Progress Bars
            gridEl.innerHTML = ""; // Clear loader
            
            const counts = data.category_counts;
            const categories = Object.keys(counts);
            
            if (categories.length === 0) {
                gridEl.innerHTML = `<p class="col-span-2 text-white/50 italic">No data available.</p>`;
                return;
            }

            // Find max value to calculate percentage relative to the highest count
            const maxCount = Math.max(...Object.values(counts));

            categories.forEach(cat => {
                const count = counts[cat];
                // Calculate width percentage relative to the highest category count
                const widthPercent = (count / maxCount) * 100;
                
                // Label
                const label = document.createElement("p");
                label.className = "text-[13px] text-text-secondary text-right";
                label.textContent = `${cat} (${count})`;
                
                // Bar Container
                const barContainer = document.createElement("div");
                barContainer.className = "h-2 rounded-full bg-primary/20 w-full";
                
                // Bar Fill
                const barFill = document.createElement("div");
                barFill.className = "bg-primary h-2 rounded-full transition-all duration-1000 ease-out";
                barFill.style.width = "0%"; // Start at 0 for animation

                barContainer.appendChild(barFill);
                
                // Append to grid
                gridEl.appendChild(label);
                gridEl.appendChild(barContainer);

                // Trigger animation
                setTimeout(() => {
                    barFill.style.width = `${widthPercent}%`;
                }, 100);
            });

        } catch (err) {
            console.error(err);
            gridEl.innerHTML = `<p class="col-span-2 text-red-400">Error loading data.</p>`;
            totalDocsEl.textContent = "-";
            uniqueCatsEl.textContent = "-";
        }
    }

    // Run on load
    loadAnalysis();
  </script>

</body>
</html>